<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>diffpy.pdfmorph.pdfmorphapp &mdash; diffpy.pdfmorph 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f539c95a"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            diffpy.pdfmorph
          </a>
              <div class="version">
                0.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">PDFmorph Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/diffpy.pdfmorph.html">Package API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">diffpy.pdfmorph</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">diffpy.pdfmorph.pdfmorphapp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for diffpy.pdfmorph.pdfmorphapp</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1"># diffpy.pdfmorph   by DANSE Diffraction group</span>
<span class="c1">#                   Simon J. L. Billinge</span>
<span class="c1">#                   (c) 2010 Trustees of the Columbia University</span>
<span class="c1">#                   in the City of New York.  All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># File coded by:    Chris Farrow</span>
<span class="c1">#</span>
<span class="c1"># See AUTHORS.txt for a list of people who contributed.</span>
<span class="c1"># See LICENSE.txt for license information.</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.morph_helpers</span> <span class="k">as</span> <span class="nn">helpers</span>
<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.morphs</span> <span class="k">as</span> <span class="nn">morphs</span>
<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.pdfmorph_io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.pdfplot</span> <span class="k">as</span> <span class="nn">pdfplot</span>
<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.refine</span> <span class="k">as</span> <span class="nn">refine</span>
<span class="kn">import</span> <span class="nn">diffpy.pdfmorph.tools</span> <span class="k">as</span> <span class="nn">tools</span>
<span class="kn">from</span> <span class="nn">diffpy.pdfmorph</span> <span class="kn">import</span> <span class="n">__save_morph_as__</span>
<span class="kn">from</span> <span class="nn">diffpy.pdfmorph.version</span> <span class="kn">import</span> <span class="n">__version__</span>


<div class="viewcode-block" id="create_option_parser">
<a class="viewcode-back" href="../../../api/diffpy.pdfmorph.html#diffpy.pdfmorph.pdfmorphapp.create_option_parser">[docs]</a>
<span class="k">def</span> <span class="nf">create_option_parser</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">optparse</span>

    <span class="n">prog_short</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Program name, compatible w/ all OS paths</span>

    <span class="k">class</span> <span class="nc">CustomParser</span><span class="p">(</span><span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">CustomParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">custom_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;custom_error(msg : string)</span>

<span class="sd">            Print a message incorporating &#39;msg&#39; to stderr and exit.</span>
<span class="sd">            Does not print usage.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: error: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_prog_name</span><span class="p">(),</span> <span class="n">msg</span><span class="p">))</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">CustomParser</span><span class="p">(</span>
        <span class="n">usage</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;%prog [options] FILE1 FILE2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Manipulate and compare PDFs.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Use --help for help.&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">),</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;Please report bugs to diffpy-users@googlegroups.com.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;For more information, see the PDFmorph website at https://www.diffpy.org/diffpy.pdfmorph.&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-V&quot;</span><span class="p">,</span> <span class="s2">&quot;--version&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show program version and exit.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">__version__</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--save&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;slocation&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Save the manipulated PDF to a file named NAME. Use </span><span class="se">\&#39;</span><span class="s2">-</span><span class="se">\&#39;</span><span class="s2"> for stdout.</span>
<span class="s2"> When --multiple is enabled, save each manipulated PDF as a file in a directory named NAME;</span>
<span class="s2"> you can specify names for each saved PDF file using --save-names-file.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print additional header details to saved files.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--rmin&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum r-value to use for PDF comparisons.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--rmax&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum r-value to use for PDF comparisons.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--pearson&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximize agreement in the Pearson function. Note that this is insensitive to scale.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--addpearson&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;addpearson&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Maximize agreement in the Pearson function as well as</span>
<span class="s2"> minimizing the residual.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Manipulations</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span>
        <span class="s2">&quot;Manipulations&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;These options select the manipulations that are to be applied to</span>
<span class="sd"> the PDF from FILE1. The passed values will be refined unless specifically</span>
<span class="sd"> excluded with the -a or -x options. If no option is specified, the PDFs from FILE1 and FILE2 will</span>
<span class="sd"> be plotted without any manipulations.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--apply&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;refine&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apply manipulations but do not refine.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-x&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--exclude&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;exclude&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;MANIP&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Exclude a manipulation from refinement by name. This can</span>
<span class="s2"> appear multiple times.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--scale&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SCALE&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apply scale factor SCALE.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--smear&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SMEAR&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Smear peaks with a Gaussian of width SMEAR.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--stretch&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;STRETCH&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Stretch PDF by a fraction STRETCH.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--slope&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Slope of the baseline. This is used when applying the smear</span>
<span class="s2"> factor. It will be estimated if not provided.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--qdamp&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;QDAMP&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Dampen PDF by a factor QDAMP.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--radius&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;RADIUS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Apply characteristic function of sphere with radius RADIUS.</span>
<span class="s2"> If PRADIUS is also specified, instead apply characteristic function of spheroid with equatorial</span>
<span class="s2"> radius RADIUS and polar radius PRADIUS.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--pradius&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PRADIUS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Apply characteristic function of spheroid with equatorial</span>
<span class="s2"> radius RADIUS and polar radius PRADIUS. If only PRADIUS is specified, instead apply</span>
<span class="s2"> characteristic function of sphere with radius PRADIUS.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--iradius&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;IRADIUS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Apply inverse characteristic function of sphere with radius IRADIUS.</span>
<span class="s2">         If IPRADIUS is also specified, instead apply inverse characteristic function of spheroid</span>
<span class="s2">         with equatorial radius IRADIUS and polar radius IPRADIUS.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--ipradius&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;IPRADIUS&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Apply inverse characteristic function of spheroid with equatorial radius IRADIUS</span>
<span class="s2">         and polar radius IPRADIUS. If only IPRADIUS is specified, instead apply inverse characteristic</span>
<span class="s2">         function of sphere with radius IPRADIUS.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Plot Options</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span>
        <span class="s2">&quot;Plot Options&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;These options control plotting.</span>
<span class="sd"> The manipulated and target PDFs will be plotted against each other with a</span>
<span class="sd"> difference curve below. When --multiple is enabled, the value of a parameter (specified by</span>
<span class="sd"> --plot-parameter) will be plotted instead.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--noplot&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Do not show a plot.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--mlabel&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;MLABEL&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mlabel&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set label for morphed data to MLABEL on plot. Default label is FILE1.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--tlabel&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;TLABEL&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tlabel&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set label for target data to TLABEL on plot. Default label is FILE2.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--pmin&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Minimum r-value to plot. Defaults to RMIN.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--pmax&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Maximum r-value to plot. Defaults to RMAX.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--maglim&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Magnify plot curves beyond r=MAGLIM by MAG.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--mag&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Magnify plot curves beyond r=MAGLIM by MAG.&quot;</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--lwidth&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Line thickness of plotted curves.&quot;</span><span class="p">)</span>

    <span class="c1"># Multiple morph options</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span>
        <span class="n">parser</span><span class="p">,</span>
        <span class="s2">&quot;Multiple Morphs&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This program can morph a PDF against multiple targets in one command.</span>
<span class="sd"> See -s and Plot Options for how saving and plotting functionality changes when performing multiple morphs.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--multiple&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Changes usage to </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">prog_short</span><span class="si">}</span><span class="s2"> [options] FILE DIRECTORY</span><span class="se">\&#39;</span><span class="s2">. FILE</span>
<span class="s2"> will be morphed with each file in DIRECTORY as target.</span>
<span class="s2"> Files in DIRECTORY are sorted by alphabetical order unless a field is</span>
<span class="s2"> specified by --sort-by.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--sort-by&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;FIELD&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;field&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Used with --multiple to sort files in DIRECTORY by FIELD.</span>
<span class="s2"> If the FIELD being used has a numerical value, sort from lowest to highest.</span>
<span class="s2"> Otherwise, sort in ASCII sort order.</span>
<span class="s2"> FIELD must be included in the header of all the PDF files.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--reverse&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;reverse&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Sort from highest to lowest instead.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--serial-file&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;SERIALFILE&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;serfile&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Look for FIELD in a serial file instead.</span>
<span class="s2"> Must specify name of serial file SERIALFILE.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--save-names-file&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;NAMESFILE&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;snamesfile&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Used when both -s and --multiple are enabled.</span>
<span class="s2"> Specify names for each manipulated PDF when saving (see -s) using a serial file</span>
<span class="s2"> NAMESFILE. The format of NAMESFILE should be as follows: each target PDF</span>
<span class="s2"> is an entry in NAMESFILE. For each entry, there should be a key </span><span class="si">{</span><span class="n">__save_morph_as__</span><span class="si">}</span>
<span class="s2"> whose value specifies the name to save the manipulated PDF as. An example .json</span>
<span class="s2"> serial file is shown in the PDFmorph manual.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s2">&quot;--plot-parameter&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;PLOTPARAM&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;plotparam&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Used when both plotting and --multiple are enabled.</span>
<span class="s2"> Choose a PLOTPARAM to plot for each morph (i.e. adding --plot-parameter=Pearson means the</span>
<span class="s2"> program will display a plot of the Pearson correlation coefficient for each morph-target</span>
<span class="s2"> pair). PLOTPARAM is not case sensitive, so both Pearson and pearson indicate the same</span>
<span class="s2"> parameter. When PLOTPARAM is not specified, Rw values for each morph-target pair will be</span>
<span class="s2"> plotted. PLOTPARAM will be displayed as the vertical axis label for the plot.&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Defaults</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">multiple</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">refine</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">pearson</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">addpearson</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">lwidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span></div>



<div class="viewcode-block" id="single_morph">
<a class="viewcode-back" href="../../../api/diffpy.pdfmorph.html#diffpy.pdfmorph.pdfmorphapp.single_morph">[docs]</a>
<span class="k">def</span> <span class="nf">single_morph</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">,</span> <span class="n">stdout_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;You must supply FILE1 and FILE2.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Too many arguments. Make sure you only supply FILE1 and FILE2.&quot;</span><span class="p">)</span>

    <span class="c1"># Get the PDFs</span>
    <span class="n">x_morph</span><span class="p">,</span> <span class="n">y_morph</span> <span class="o">=</span> <span class="n">getPDFFromFile</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x_target</span><span class="p">,</span> <span class="n">y_target</span> <span class="o">=</span> <span class="n">getPDFFromFile</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Get configuration values</span>
    <span class="n">scale_in</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
    <span class="n">stretch_in</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
    <span class="n">smear_in</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;rmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmin</span>
    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;rmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmax</span>
    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;rstep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmax</span> <span class="o">&lt;=</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmin</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;rmin must be less than rmax&quot;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="c1"># Set up the morphs</span>
    <span class="n">chain</span> <span class="o">=</span> <span class="n">morphs</span><span class="o">.</span><span class="n">MorphChain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="c1"># Add the r-range morph, we will remove it when saving and plotting</span>
    <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphRGrid</span><span class="p">())</span>
    <span class="n">refpars</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Scale</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale_in</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphScale</span><span class="p">())</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">)</span>
    <span class="c1"># Stretch</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">stretch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stretch_in</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">stretch</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphStretch</span><span class="p">())</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;stretch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">stretch</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;stretch&quot;</span><span class="p">)</span>
    <span class="c1"># Smear</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">smear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">smear_in</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">smear</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helpers</span><span class="o">.</span><span class="n">TransformXtalPDFtoRDF</span><span class="p">())</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphSmear</span><span class="p">())</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">helpers</span><span class="o">.</span><span class="n">TransformXtalRDFtoPDF</span><span class="p">())</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;smear&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;smear&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">smear</span>
        <span class="c1"># Set baselineslope if not given</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">baselineslope</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">baselineslope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">)</span>
    <span class="c1"># Size</span>
    <span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">pradius</span><span class="p">]</span>
    <span class="n">nrad</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">radii</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nrad</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">radii</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;radius or pradius&quot;</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphSphere</span><span class="p">())</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">nrad</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;radius&quot;</span><span class="p">)</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;pradius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;pradius&quot;</span><span class="p">)</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;pradius&quot;</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphSpheroid</span><span class="p">())</span>
    <span class="n">iradii</span> <span class="o">=</span> <span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">iradius</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">ipradius</span><span class="p">]</span>
    <span class="n">inrad</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">iradii</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inrad</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">iradii</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;iradius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">iradii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;iradius or ipradius&quot;</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphISphere</span><span class="p">())</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;iradius&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">inrad</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;iradius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">iradii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;iradius&quot;</span><span class="p">)</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;iradius&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;ipradius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">nn_value</span><span class="p">(</span><span class="n">iradii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ipradius&quot;</span><span class="p">)</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ipradius&quot;</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphISpheroid</span><span class="p">())</span>

    <span class="c1"># Resolution</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">qdamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">MorphResolutionDamping</span><span class="p">())</span>
        <span class="n">refpars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;qdamp&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;qdamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">qdamp</span>

    <span class="c1"># Now remove non-refinable parameters</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">refpars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">refpars</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">exclude</span><span class="p">))</span>

    <span class="c1"># Refine or execute the morph</span>
    <span class="n">refiner</span> <span class="o">=</span> <span class="n">refine</span><span class="o">.</span><span class="n">Refiner</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">x_morph</span><span class="p">,</span> <span class="n">y_morph</span><span class="p">,</span> <span class="n">x_target</span><span class="p">,</span> <span class="n">y_target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">pearson</span><span class="p">:</span>
        <span class="n">refiner</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">refiner</span><span class="o">.</span><span class="n">_pearson</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">addpearson</span><span class="p">:</span>
        <span class="n">refiner</span><span class="o">.</span><span class="n">residual</span> <span class="o">=</span> <span class="n">refiner</span><span class="o">.</span><span class="n">_add_pearson</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">refine</span> <span class="ow">and</span> <span class="n">refpars</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># This works better when we adjust scale and smear first.</span>
            <span class="k">if</span> <span class="s2">&quot;smear&quot;</span> <span class="ow">in</span> <span class="n">refpars</span><span class="p">:</span>
                <span class="n">rptemp</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;smear&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">in</span> <span class="n">refpars</span><span class="p">:</span>
                    <span class="n">rptemp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">)</span>
                <span class="n">refiner</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="o">*</span><span class="n">rptemp</span><span class="p">)</span>
            <span class="c1"># Adjust all parameters</span>
            <span class="n">refiner</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="o">*</span><span class="n">refpars</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="c1"># Smear is not being refined, but baselineslope needs to refined to apply smear</span>
    <span class="c1"># Note that baselineslope is only added to the refine list if smear is applied</span>
    <span class="k">elif</span> <span class="s2">&quot;baselineslope&quot;</span> <span class="ow">in</span> <span class="n">refpars</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">refiner</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">,</span> <span class="n">baselineslope</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;baselineslope&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chain</span><span class="p">(</span><span class="n">x_morph</span><span class="p">,</span> <span class="n">y_morph</span><span class="p">,</span> <span class="n">x_target</span><span class="p">,</span> <span class="n">y_target</span><span class="p">)</span>

    <span class="c1"># Get Rw for the morph range</span>
    <span class="n">rw</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">getRw</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
    <span class="n">pcc</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_pearson</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
    <span class="c1"># Replace the MorphRGrid with Morph identity</span>
    <span class="n">chain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">morphs</span><span class="o">.</span><span class="n">Morph</span><span class="p">()</span>
    <span class="n">chain</span><span class="p">(</span><span class="n">x_morph</span><span class="p">,</span> <span class="n">y_morph</span><span class="p">,</span> <span class="n">x_target</span><span class="p">,</span> <span class="n">y_target</span><span class="p">)</span>

    <span class="c1"># Input morph parameters</span>
    <span class="n">morph_inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale_in</span><span class="p">,</span> <span class="s2">&quot;stretch&quot;</span><span class="p">:</span> <span class="n">stretch_in</span><span class="p">,</span> <span class="s2">&quot;smear&quot;</span><span class="p">:</span> <span class="n">smear_in</span><span class="p">}</span>

    <span class="c1"># Output morph parameters</span>
    <span class="n">morph_results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="c1"># Ensure Rw, Pearson last two outputs</span>
    <span class="n">morph_results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Rw&quot;</span><span class="p">:</span> <span class="n">rw</span><span class="p">})</span>
    <span class="n">morph_results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Pearson&quot;</span><span class="p">:</span> <span class="n">pcc</span><span class="p">})</span>

    <span class="c1"># Print summary to terminal and save morph to file if requested</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">io</span><span class="o">.</span><span class="n">single_morph_output</span><span class="p">(</span>
            <span class="n">morph_inputs</span><span class="p">,</span>
            <span class="n">morph_results</span><span class="p">,</span>
            <span class="n">save_file</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">slocation</span><span class="p">,</span>
            <span class="n">morph_file</span><span class="o">=</span><span class="n">pargs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">xy_out</span><span class="o">=</span><span class="p">[</span><span class="n">chain</span><span class="o">.</span><span class="n">x_morph_out</span><span class="p">,</span> <span class="n">chain</span><span class="o">.</span><span class="n">y_morph_out</span><span class="p">],</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">stdout_flag</span><span class="o">=</span><span class="n">stdout_flag</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">save_fail_message</span> <span class="o">=</span> <span class="s2">&quot;Unable to save to designated location.&quot;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="n">save_fail_message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">plot</span><span class="p">:</span>
        <span class="n">pairlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">chain</span><span class="o">.</span><span class="n">xy_morph_out</span><span class="p">,</span> <span class="n">chain</span><span class="o">.</span><span class="n">xy_target_out</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">pargs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pargs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Default is to use file names</span>

        <span class="c1"># If user chooses labels</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">mlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">mlabel</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">tlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">tlabel</span>

        <span class="c1"># Plot extent defaults to calculation extent</span>
        <span class="n">pmin</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">pmin</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">pmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmin</span>
        <span class="n">pmax</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">pmax</span> <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">pmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">opts</span><span class="o">.</span><span class="n">rmax</span>
        <span class="n">maglim</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">maglim</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">mag</span>
        <span class="n">l_width</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">lwidth</span>
        <span class="n">pdfplot</span><span class="o">.</span><span class="n">comparePDFs</span><span class="p">(</span>
            <span class="n">pairlist</span><span class="p">,</span>
            <span class="n">labels</span><span class="p">,</span>
            <span class="n">rmin</span><span class="o">=</span><span class="n">pmin</span><span class="p">,</span>
            <span class="n">rmax</span><span class="o">=</span><span class="n">pmax</span><span class="p">,</span>
            <span class="n">maglim</span><span class="o">=</span><span class="n">maglim</span><span class="p">,</span>
            <span class="n">mag</span><span class="o">=</span><span class="n">mag</span><span class="p">,</span>
            <span class="n">rw</span><span class="o">=</span><span class="n">rw</span><span class="p">,</span>
            <span class="n">l_width</span><span class="o">=</span><span class="n">l_width</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">morph_results</span></div>



<div class="viewcode-block" id="multiple_morphs">
<a class="viewcode-back" href="../../../api/diffpy.pdfmorph.html#diffpy.pdfmorph.pdfmorphapp.multiple_morphs">[docs]</a>
<span class="k">def</span> <span class="nf">multiple_morphs</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">,</span> <span class="n">stdout_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># Custom error messages since usage is distinct when --multiple tag is applied</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="s2">&quot;You must supply FILE and DIRECTORY. See --multiple under --help for usage.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="s2">&quot;Too many arguments. You must only supply a FILE and a DIRECTORY.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse paths</span>
    <span class="n">morph_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">morph_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">morph_file</span><span class="si">}</span><span class="s2"> is not a file. Go to --help for usage.&quot;</span><span class="p">)</span>
    <span class="n">target_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pargs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_directory</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_directory</span><span class="si">}</span><span class="s2"> is not a directory. Go to --help for usage.&quot;</span><span class="p">)</span>

    <span class="c1"># Get list of files from target directory</span>
    <span class="n">target_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_directory</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">target_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">target_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># Do not morph morph_file against itself if it is in the same directory</span>
    <span class="k">if</span> <span class="n">morph_file</span> <span class="ow">in</span> <span class="n">target_list</span><span class="p">:</span>
        <span class="n">target_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">morph_file</span><span class="p">)</span>

    <span class="c1"># Format field name for printing and plotting</span>
    <span class="n">field</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">field_words</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">field</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">field_words</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}{</span><span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">field_list</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Sort files in directory by some field</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">target_list</span><span class="p">,</span> <span class="n">field_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">field_sort</span><span class="p">(</span>
                <span class="n">target_list</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">serfile</span><span class="p">,</span> <span class="n">get_field_values</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">serfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="s2">&quot;The requested field was not found in the metadata file.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="s2">&quot;The requested field is missing from a PDF file header.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Default is alphabetical sort</span>
        <span class="n">target_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">reverse</span><span class="p">)</span>

    <span class="c1"># Disable single morph plotting</span>
    <span class="n">plot_opt</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">plot</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set up saving</span>
    <span class="n">save_directory</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">slocation</span>  <span class="c1"># User-given directory for saves</span>
    <span class="n">save_names_file</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">snamesfile</span>  <span class="c1"># User-given serialfile with names for each morph</span>
    <span class="n">save_morphs_here</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Subdirectory for saving morphed PDFs</span>
    <span class="n">save_names</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Dictionary of names to save each morph as</span>
    <span class="k">if</span> <span class="n">save_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">save_morphs_here</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">create_morphs_directory</span><span class="p">(</span><span class="n">save_directory</span><span class="p">)</span>

        <span class="c1"># Could not create directory or find names to save morphs as</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">save_fail_message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unable to create directory&quot;</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="n">save_fail_message</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">save_names</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_multisave_names</span><span class="p">(</span><span class="n">target_list</span><span class="p">,</span> <span class="n">save_names_file</span><span class="o">=</span><span class="n">save_names_file</span><span class="p">)</span>
            <span class="c1"># Could not create directory or find names to save morphs as</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">save_fail_message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unable to read from save names file&quot;</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="n">save_fail_message</span><span class="p">)</span>

    <span class="c1"># Morph morph_file against all other files in target_directory</span>
    <span class="n">morph_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">target_file</span> <span class="ow">in</span> <span class="n">target_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">:</span>
            <span class="c1"># Set the save file destination to be a file within the SLOC directory</span>
            <span class="k">if</span> <span class="n">save_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">save_as</span> <span class="o">=</span> <span class="n">save_names</span><span class="p">[</span><span class="n">target_file</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">__save_morph_as__</span><span class="p">]</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">slocation</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save_morphs_here</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">save_as</span><span class="p">)</span>
            <span class="c1"># Perform a morph of morph_file against target_file</span>
            <span class="n">pargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">morph_file</span><span class="p">,</span> <span class="n">target_file</span><span class="p">]</span>
            <span class="n">morph_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">target_file</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">single_morph</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">,</span> <span class="n">stdout_flag</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="n">target_file_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">morph_results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">target_file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="n">morph_inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="s2">&quot;stretch&quot;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">stretch</span><span class="p">,</span> <span class="s2">&quot;smear&quot;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">smear</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Print summary of morphs to terminal and to file (if requested)</span>
        <span class="n">io</span><span class="o">.</span><span class="n">multiple_morph_output</span><span class="p">(</span>
            <span class="n">morph_inputs</span><span class="p">,</span>
            <span class="n">morph_results</span><span class="p">,</span>
            <span class="n">target_file_names</span><span class="p">,</span>
            <span class="n">save_directory</span><span class="o">=</span><span class="n">save_directory</span><span class="p">,</span>
            <span class="n">morph_file</span><span class="o">=</span><span class="n">morph_file</span><span class="p">,</span>
            <span class="n">target_directory</span><span class="o">=</span><span class="n">target_directory</span><span class="p">,</span>
            <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
            <span class="n">field_list</span><span class="o">=</span><span class="n">field_list</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">stdout_flag</span><span class="o">=</span><span class="n">stdout_flag</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
        <span class="n">save_fail_message</span> <span class="o">=</span> <span class="s2">&quot;Unable to save summary to directory.&quot;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="n">save_fail_message</span><span class="p">)</span>

    <span class="c1"># Plot the values of some parameter for each target if requested</span>
    <span class="k">if</span> <span class="n">plot_opt</span><span class="p">:</span>
        <span class="n">plot_results</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">tabulate_results</span><span class="p">(</span><span class="n">morph_results</span><span class="p">)</span>
        <span class="c1"># Default parameter is Rw</span>
        <span class="n">param_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$R_w$&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="n">plot_results</span><span class="p">[</span><span class="s2">&quot;Rw&quot;</span><span class="p">]</span>
        <span class="c1"># Find parameter if specified</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">plotparam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">plotparam</span>
            <span class="n">param_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">case_insensitive_dictionary_search</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">plotparam</span><span class="p">,</span> <span class="n">plot_results</span><span class="p">)</span>
        <span class="c1"># Not an available parameter to plot or no values found for the parameter</span>
        <span class="k">if</span> <span class="n">param_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span><span class="s2">&quot;Cannot find specified plot parameter. No plot shown.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">pdfplot</span><span class="o">.</span><span class="n">plot_param</span><span class="p">(</span><span class="n">field_list</span><span class="p">,</span> <span class="n">param_list</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pdfplot</span><span class="o">.</span><span class="n">plot_param</span><span class="p">(</span><span class="n">target_file_names</span><span class="p">,</span> <span class="n">param_list</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span>
            <span class="c1"># Can occur for non-refined plotting parameters</span>
            <span class="c1"># i.e. --smear is not selected as an option, but smear is the plotting parameter</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">custom_error</span><span class="p">(</span>
                    <span class="s2">&quot;The plot parameter is missing values for at least one morph and target pair. &quot;</span>
                    <span class="s2">&quot;No plot shown.&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">morph_results</span></div>



<div class="viewcode-block" id="getPDFFromFile">
<a class="viewcode-back" href="../../../api/diffpy.pdfmorph.html#diffpy.pdfmorph.pdfmorphapp.getPDFFromFile">[docs]</a>
<span class="k">def</span> <span class="nf">getPDFFromFile</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">diffpy.pdfmorph.tools</span> <span class="kn">import</span> <span class="n">readPDF</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">gr</span> <span class="o">=</span> <span class="n">readPDF</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">errmsg</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">errmsg</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot read </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">gr</span></div>



<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../api/diffpy.pdfmorph.html#diffpy.pdfmorph.pdfmorphapp.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">create_option_parser</span><span class="p">()</span>
    <span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">multiple</span><span class="p">:</span>
        <span class="n">multiple_morphs</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">,</span> <span class="n">stdout_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">single_morph</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">pargs</span><span class="p">,</span> <span class="n">stdout_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The Trustees of Columbia University in the City of New York.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>